import{al as D,O as V,ab as G,ad as R,ap as W,D as E,aq as L,J as j,af as k,H as z,aA as q,V as N,y as P,ai as v,u as Q,ag as U,aj as J,aB as A,aC as X,aD as Y,am as $,ar as K,C as Z,s as C,I as _,d as T,at as ee,e as I,Q as ne,au as te}from"./StaticSceneBVH-Cy08W0XA.js";function ae(n){this.sceneBoundsTree=new D(this,n)}function se(){this.sceneBoundsTree=null}function oe(n,e){if(this.sceneBoundsTree)return this.sceneBoundsTree.raycast(n,e),!1}V.prototype.computeSceneBoundsTree=ae;V.prototype.disposeSceneBoundsTree=se;const a={mode:"batched",animate:!0,useBVH:!0,strategy:A,precise:!1,includeInstances:!0,showHelper:!1,helperDepth:15,helperParents:!1,firstHitOnly:!0};let p,h,u,x,B,d,i,g,H,y,F;ie();O();function ie(){F=document.getElementById("output"),p=new G({antialias:!0}),p.setPixelRatio(window.devicePixelRatio),p.setSize(window.innerWidth,window.innerHeight),p.setClearColor(1250841,1),p.setAnimationLoop(le),document.body.appendChild(p.domElement),h=new R,h.fog=new W(1250841,0,10);const n=new E(16777215,2.5);n.position.set(1,2,1);const e=new E(16777215,.75);e.position.set(-1,-2,-1),h.add(n,e,new L(16777215,.75)),u=new j(75,window.innerWidth/window.innerHeight,.1,200),u.position.set(18,10,0),x=new k(u,p.domElement),x.enablePan=!1,x.enableDamping=!0,d=new z,h.add(d),g=new q,H=new N,y=new P(new v(.1,16,16),new Q({color:16776960,transparent:!0,opacity:.75,fog:!1})),y.visible=!1,h.add(y),B=new U,document.body.appendChild(B.dom),re(),window.addEventListener("resize",()=>{u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight)}),window.addEventListener("pointermove",s=>{H.x=s.clientX/window.innerWidth*2-1,H.y=-(s.clientY/window.innerHeight)*2+1})}function re(){const n=new J;n.add(a,"mode",["group","instanced","batched","mix"]).onChange(O),n.add(a,"animate");const e=n.addFolder("BVH");e.add(a,"useBVH").onChange(w),e.add(a,"strategy",{CENTER:A,AVERAGE:Y,SAH:X}).onChange(w),e.add(a,"precise").onChange(w),e.add(a,"includeInstances").onChange(w),e.add(a,"firstHitOnly").onChange(()=>g.firstHitOnly=a.firstHitOnly),e.open();const s=n.addFolder("Helper");s.add(a,"showHelper"),s.add(a,"helperDepth",1,20,1).onChange(t=>{i&&(i.depth=t,i.update())}),s.add(a,"helperParents").onChange(t=>{i&&(i.displayParents=t,i.update())})}function de(){he(d);const n=1e4,e=[new K(.25,.1,30,30),new v(.25,30,30)],s=[15277667,240116,5025616,16761095,10233776].map(o=>new Z(o)),t={group:0,instanced:0,batched:0};switch(a.mode){case"group":t.group=n;break;case"instanced":t.instanced=n;break;case"batched":t.batched=n;break;case"mix":t.group=t.instanced=t.batched=Math.ceil(n/3);break}if(t.group){const o=s.map(c=>new C({color:c}));for(let c=0;c<t.group;c++){const r=new P(e[c%e.length],o[c%o.length]);M(r.matrix).decompose(r.position,r.quaternion,r.scale),d.add(r)}}if(t.instanced&&e.forEach(o=>{const c=Math.ceil(t.instanced/e.length),r=new _(o,new C,c),b=new T;for(let f=0;f<c;f++)r.setMatrixAt(f,M(b)),r.setColorAt(f,s[f%s.length]);d.add(r)}),t.batched){const o=e.reduce((l,m)=>l+m.attributes.position.count,0),c=e.reduce((l,m)=>{var S;return l+(((S=m.index)==null?void 0:S.count)||0)},0),r=new ee(t.batched,o,c,new C),b=e.map(l=>r.addGeometry(l)),f=new T;for(let l=0;l<t.batched;l++){const m=r.addInstance(b[l%b.length]);r.setMatrixAt(m,M(f)),r.setColorAt(m,s[l%s.length])}d.add(r)}}function w(){i&&(i.dispose(),h.remove(i),i=null),d.disposeSceneBoundsTree(),a.useBVH&&(console.time("BVH Build"),d.updateMatrixWorld(),d.computeSceneBoundsTree({strategy:a.strategy,precise:a.precise,includeInstances:a.includeInstances}),d.raycast=oe,console.timeEnd("BVH Build"),i=new $(d,d.sceneBoundsTree,a.helperDepth),i.displayParents=a.displayParents,i.color.set(16777215),i.opacity=.6,h.add(i))}function O(){de(),w()}function ce(){g.setFromCamera(H,u),g.firstHitOnly=a.firstHitOnly;const n=performance.now(),e=g.intersectObject(d,!0);F.innerText=`${(performance.now()-n).toFixed(3)}ms`,y.visible=e.length>0,e.length&&y.position.copy(e[0].point)}function le(){B.begin(),i&&(i.visible=a.showHelper),a.animate&&(d.rotation.y+=5e-4),h.fog.near=u.position.length()-7.5,h.fog.far=u.position.length()+5,x.update(),ce(),p.render(h,u),B.end()}function M(n){const e=Math.cbrt(Math.random()),s=new I().randomDirection().multiplyScalar(10*e*e),t=new ne().setFromEuler(new te(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2)),o=new I().setScalar(.25+Math.random()*.75);return n.compose(s,t,o)}function he(n){var e,s,t;for(;n.children.length;){const o=n.children[0];(e=o.geometry)==null||e.dispose(),(s=o.material)==null||s.dispose(),(t=o.dispose)==null||t.call(o),n.remove(o)}}
//# sourceMappingURL=sceneRaycast-BxL4QWbu.js.map
