import{ab as E,J as A,ao as W,ad as F,ap as D,D as V,aq as I,af as T,ag as O,aj as G,ar as z,ai as N,as as R,C as L,at as k,s as j,d as y,al as U,am as Q,e as B,Q as $,au as q,av as J,a8 as _,aw as K,ax as X}from"./StaticSceneBVH-Cy08W0XA.js";import{m as Y,R as Z}from"./BufferGeometryUtils-CLnqpj6S.js";const s={animate:!0,thirdPerson:!1,useBVH:!0,checkBoundingSphere:!1,showHelper:!1,helperDepth:25,helperParents:!1};let p,c,i,w,M,C,H,a,r,g,v;ee();te();function ee(){v=document.getElementById("output"),p=new E({antialias:!0}),p.setPixelRatio(window.devicePixelRatio),p.setSize(window.innerWidth,window.innerHeight),p.setClearColor(1250841,1),p.setAnimationLoop(re),document.body.appendChild(p.domElement),i=new A(75,window.innerWidth/window.innerHeight,.1,100),i.position.set(18,10,0),w=new A(75,window.innerWidth/window.innerHeight,.1,400),w.position.set(0,10,200),w.lookAt(0,0,0),g=new W(i),c=new F,c.fog=new D(1250841,25,i.far),c.add(g);const d=new V(16777215,2.5);d.position.set(1,2,1);const o=new V(16777215,.75);o.position.set(-1,-2,-1),c.add(d,o,new I(16777215,.75)),M=new T(i,p.domElement),M.enablePan=!1,M.enableDamping=!0,C=new O,document.body.appendChild(C.dom);const t=new G;t.add(s,"animate"),t.add(s,"thirdPerson"),t.add(s,"useBVH"),t.add(s,"checkBoundingSphere");const m=t.addFolder("Helper");m.add(s,"showHelper"),m.add(s,"helperDepth",1,25,1).onChange(u=>{a&&(a.depth=u,a.update())}),m.add(s,"helperParents").onChange(u=>{a&&(a.displayParents=u,a.update())}),window.addEventListener("resize",()=>{i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),g.update(),p.setSize(window.innerWidth,window.innerHeight)})}function te(){const o=[new z(.25,.1,30,30),new N(.25,30,30),new R(.25,.25),Y(new Z(.25,.25,.5,4,1))],t=[15277667,240116,5025616,16761095,10233776].map(n=>new L(n)),m=o.reduce((n,e)=>n+e.attributes.position.count,0),u=o.reduce((n,e)=>{var l;return n+(((l=e.index)==null?void 0:l.count)||0)},0);r=new k(5e5,m,u,new j({roughness:.5}));const h=o.map(n=>r.addGeometry(n)),f=new y;for(let n=0;n<5e5;n++){const e=r.addInstance(h[n%h.length]);r.setMatrixAt(e,ae(f)),r.setColorAt(e,t[n%t.length]),r.setVisibleAt(e,!1)}c.add(r),c.updateMatrixWorld(),H=new U(r),a=new Q(r,H,s.helperDepth),a.color.set(16777215),a.opacity=.1,a.instanceId=-1,c.add(a)}function ne(){const{useBVH:d,checkBoundingSphere:o}=s;r.perObjectFrustumCulled=!d;for(let e=0;e<r.instanceCount;e++)r.setVisibleAt(e,!d);if(!d)return;i.updateMatrixWorld();const t=new J,m=new y().multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(r.matrixWorld);t.setFromProjectionMatrix(m,i.coordinateSystem,i.reversedDepth);const u=new y().copy(H.matrixWorld).invert(),h=new y,f=new _,n=new B;H.shapecast({intersectsBounds:e=>{if(!t.intersectsBox(e))return;const{min:l,max:x}=e;for(let b=-1;b<=1;b+=2)for(let S=-1;S<=1;S+=2)for(let P=-1;P<=1;P+=2)if(n.set(b<0?l.x:x.x,S<0?l.y:x.y,P<0?l.z:x.z),!t.containsPoint(n))return K;return X},intersectsObject:(e,l)=>{if(o){const x=e.getGeometryIdAt(l);e.getMatrixAt(l,h),h.premultiply(e.matrixWorld).premultiply(u),e.getBoundingSphereAt(x,f),f.applyMatrix4(h),t.intersectsSphere(f)&&e.setVisibleAt(l,!0)}else e.setVisibleAt(l,!0)}})}function re(){C.begin(),a&&(a.visible=s.showHelper),s.animate&&(r.rotation.y+=5e-4),M.update();const d=performance.now();ne(),s.thirdPerson?(a.opacity=.05,g.visible=!0,c.fog.far=1e10,p.render(c,w)):(a.opacity=.5,g.visible=!1,c.fog.far=i.far,p.render(c,i));const o=performance.now()-d;v.innerText=`render: ${o.toFixed(2)}ms
visible: ${r._multiDrawCount}`,C.end()}function ae(d){const o=Math.cbrt(Math.random()),t=new B().randomDirection().multiplyScalar(300*o),m=new $().setFromEuler(new q(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2)),u=new B().setScalar(1+Math.random()*3);return d.compose(t,m,u)}
//# sourceMappingURL=frustumCulling-D_Glmdnu.js.map
